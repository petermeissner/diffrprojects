---
title: Projects for Text Version Comparison and Analytics in R
output: 
  html_document: 
    keep_md: yes
    number_sections: yes
    toc: yes
    self_contained: yes
---




```{r setting options, include=FALSE}
options("width"=101)
tmp <- devtools:::read_dcf("DESCRIPTION")
knitr::opts_chunk$set(message=FALSE)
```

```{r title, results='asis', echo=FALSE, include=FALSE}
cat("#", tmp$Title)
```

# Overview

**Status**


[![Travis-CI Build Status](https://travis-ci.org/petermeissner/diffrprojects.svg?branch=master)](https://travis-ci.org/petermeissner/diffrprojects)
[![codecov](https://codecov.io/gh/petermeissner/diffrprojects/branch/master/graph/badge.svg)](https://codecov.io/gh/petermeissner/diffrprojects/tree/master/R)
[![CRAN version](http://www.r-pkg.org/badges/version/diffrprojects)](https://cran.r-project.org/package=diffrprojects)



```{r count lines of code, include=FALSE}
filelist.R   <- list.files("R", recursive = TRUE, pattern="\\.R$", ignore.case = TRUE, full.names = TRUE)
filelist.tests   <- list.files("tests", recursive = TRUE, pattern="\\.R$", ignore.case = TRUE, full.names = TRUE)
filelist.cpp <- list.files("src", recursive = TRUE, pattern="\\.cpp$", ignore.case = TRUE, full.names = TRUE)
lines.R      <- unlist(lapply(filelist.R, readLines))
lines.tests  <- unlist(lapply(filelist.tests, readLines))
lines.cpp    <- unlist(lapply(filelist.cpp, readLines))
length.R     <- 
  length(grep("(^\\s*$)|(^\\s*#)|(^\\s*//)", lines.R,  value = TRUE, invert = TRUE))
length.tests <- 
  length(grep("(^\\s*$)|(^\\s*#)|(^\\s*//)", lines.tests,  value = TRUE, invert = TRUE))
length.cpp   <- 
  length(grep("(^\\s*$)|(^\\s*#)|(^\\s*//)", lines.cpp,  value = TRUE, invert = TRUE))
```





*R code:* `r length.R`<br> 
*C++ code:* `r length.cpp`<br> 
*test code:* `r length.tests`




<br><br>
**Version**

```{r version, results='asis', echo=FALSE}
cat(tmp$Version)
```




<br><br>
**Description**

```{r description, results='asis', echo=FALSE}
cat(tmp$Description)
```



<br><br>
**License**

```{r licence, results='asis', echo=FALSE}
cat(tmp$License, "<br>")
cat(as.character(eval(parse(text=tmp$Author))))
```



<br><br>
**Citation**


```{r citation1, results='asis', echo=FALSE}
citation("diffrprojects")
```

**BibTex for citing**

```{r citation2, eval=FALSE}
toBibtex(citation("diffrprojects"))
```



<br><br>
**Installation**

stable CRAN version

```{r installation1, eval=FALSE}
install.packages("diffrprojects")
library(rtext)
```



(stable) development version

```{r installation2, eval=FALSE}
standard_repos <- options("repos")$repos
install.packages( "diffrprojects", repos = c(standard_repos, "https://petermeissner.github.io/drat/"))
library(rtext)
```



<br><br>   

# Usage




<br><br>

## Fast Introduction for the Impatient

For those in a hurry here is a very brief

```{r fast intro, cache=TRUE}
# loading package
library(diffrprojects)


# the first chapter of Robinson Crusoe from three different sources
rcs <- rtext:::testfile(pattern="rc.*ch1.txt", full.names = TRUE) 


# creating a new project
dp <- diffrproject$new()


# setting options
dp$options$verbose <- FALSE


# adding texts to the corpus
dp$text_add(text_file = rcs)
dp$text_data(1) %>% head(11)


# linking the files (which file should be compared to which)
dp$text_link()
dp$link %>% as.data.frame()


# calculating text alignments
dp$text_align(tokenizer=text_tokenize_words)
dp$alignment[[1]] %>% head(30)
```
   
   
   
   
   
   
   <br><br>
   
## Creating a Diffr Project

To create a diffrproject we use the diffrproject creator object - its simply an object with an function that knows how to create a project. 

Creating a project looks like this:

```{r new project}
library(diffrprojects)
dp <- diffrproject$new()
```

Et violÃ  - we created a first, for now empty, project that we will use throughout the tutorial. 






<br><br>

## Some Help Please 

To get a better idea about what this thing called *diffrproject* really is you can consult its help page which gives a broad overview over its capabilities:

```{r getting help, eval=FALSE}
?diffrproject
```

Another way is to call the ls() method. This will present us with a data frame listing all fields where data is stored and all the methods (aka object specific functions) of our diffrprojects instance. Those methods and fields located in *private* are not for the user to mess around with while non-private (*self* aka public) data fields can be read by the user and public methods can be triggered by the user to manipulate the data or retrieve data in a specific format. 

```{r ls method}
dp$ls()
```

The base R class() function furthermore reveals from which classes the diffrproject class inherits: 

```{r class}
class(dp)
```





<br><br>

## Adding Texts to Projects

Our diffrproject (`dp`) has one method called `text_add()` that allows to add texts to the project. Basically the method can be used in three different flavors: adding character vectors, adding texts stored on disk, or by adding rtext objects (see rtext package:  https://CRAN.R-project.org/package=rtext; rtext objects are the way individual texts are represented within diffrprojects). For each of these use cases there is one option: `text`, `text_file`, `rtext`; respectively. 

Below are shown examples using each of these methods:


**adding text files**
```{r text_add files}
test_file1 <- stringb:::test_file("rc_1_ch1.txt")
test_file2 <- stringb:::test_file("rc_2_ch1.txt")
dp$text_add(text_file = c(test_file1, test_file2) )
```


**adding rtext objects**
```{r text_add rtext}
test_file <- stringb:::test_file("rc_1_ch1.txt")
rt <- rtext$new( text_file = test_file)
dp$text_add(rtext = rt)
```


**adding character vectors**
```{r text_add character vector}
test_file1 <- stringb:::test_file("rc_1_ch1.txt")
test_file2 <- stringb:::test_file("rc_2_ch1.txt")
cv <- ""
cv[1] <- text_read(test_file1, NULL)
cv[2] <- text_read(test_file2, NULL)
dp$text_add(text = cv)
```

In the last case make sure to put each text in one separate line. Functions like 
readLines() or text_read() read in texts such that each line corresponds to one element in a character vector. With e.g. text_read()'s tokenize parameter to NULL the text will be read in as one long string. 





<br><br>

## Piping methods 

Now is a good time to mention a feature of diffrprojects that comes in handy: All functions that do not explicitly extract data (those usually have some 'get' as part of their name) do return return the object itself so that one can pipe together a series of method calls.

Consider the following example where we initiate a new diffrprojects instance and add two texts in just one pipe:

```{r piping}
dp <- 
  diffrproject$
  new()$
  text_add(text_version_1, name = "version1")$
  text_add(text_version_2, name = "version2")

length(dp$text)
```




## Getting Infos About Texts 

If we want to get some general overview about the texts gathered in our project we can use the text_meta_data() method to do so. The method has no parameters and return a data.frame with several variables informing us about its source, length, encoding used for storage, and its name. 

```{r text meta data}
dp$text_meta_data()
```


## Getting And Setting Infos About the Project

Similar to the text_meta_data() method we can access the projects meta data via data fields meta and options. But contrary to the text_meta_data() method that gathers data from all the texts within the project and does not allow for manipulation of the data, the data fields allow reading and writing. 

First let us have a look and thereafter turn of the message notification service:

**getting data fields**
```{r options get}
dp$options
```

**setting data fields**
```{r options set}
dp$options$verbose <- FALSE
```

(note, ask is deprecated and only remains for compatibility reasons but has no function anymore)

Now its time to have a look at the projects meta data. It tells us when the project was created, which path to use for SQLite exports, which path to use for saving data as in RData format and what is the projects id. The id is a hash of a time stamp as well as session information which should ensure uniqueness across space and time. 

All these values can manipulated by the user to her liking. 

```{r meta}
dp$meta

dp$meta$file_path = "./diffrproject.RData"
```





<br><br>

## Deleting Texts 

Of cause we can not only add texts but delete them from the project as well. For this purpose there is the text_delete() method.

Let's just add two texts and delete one by providing its index number and the second by providing its name to the text_delete() method. 

```{r text deletion}
dp$text_add(text = "nonesense", "n1")
dp$text_add(text = "nonesense", "n2")

dp$text_delete(3)
dp$text_delete("n2")

length(dp$text)
names(dp$text)
```




<br><br>

## Coding Texts

```{r}

```



<br><br>

## Getting Text Codings

```{r}

```



<br><br>

## Aggregating Text Codings

```{r}

```





<br><br>

## Measuring Change and Aligning Texts

```{r}

```




<br><br>

## Text Coding Inheritence

```{r}

```




<br><br>

## _

```{r}

```



<br><br>

## _

```{r}

```




<br><br>

## _

```{r}

```




<br><br>

## _

```{r}

```




<br><br>

## _

```{r}

```




<br><br>

## _

```{r}

```




<br><br>

## _

```{r}

```




<br><br>

## _

```{r}

```




<br><br>

## _

```{r}

```




<br><br>

## _

```{r}

```



<br><br>

## _

```{r}

```



<br><br>

## _

```{r}

```


<br><br>

## _

```{r}

```















































